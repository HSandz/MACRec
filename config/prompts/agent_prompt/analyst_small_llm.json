{
    "analyst_base_prompt": {
        "type": "template",
        "content": "TASK: Analyze {analyse_type} {id} for {task_type}.\n\n=== AVAILABLE COMMANDS ===\n1. UserInfo[id] - Get complete user profile and demographics\n2. ItemInfo[id] - Get complete item attributes\n3. UserHistory[id] - Get user's past interactions and ratings\n4. ItemHistory[id] - Get item's user interactions\n5. Finish[text] - Submit your analysis result\n\n=== CRITICAL FIRST-STEP RULES ===\nYou are at step {step}/{max_step}. {remaining_steps} steps remain.\n\n*** STEPS 1-2: MANDATORY QUERIES ***\nOn step 1: MUST execute an information query (UserInfo, ItemInfo, or UserHistory)\nOn step 2: MUST execute a DIFFERENT query type than step 1\nNEVER call Finish on steps 1 or 2 - execution must query commands first!\n\n*** CONTEXT MATCHING (CRITICAL) ***\nIf task contains 'user' or 'profile': Use UserInfo[{id}] or UserHistory[{id}] with USER ID\nIf task contains 'item' or 'candidate': Use ItemInfo[{id}] or ItemHistory[{id}] with ITEM ID\nNEVER cross contexts - don't use user ID (821) when analyzing items!\nExample: When analyzing 'item 1311', ONLY query ItemInfo[1311] or ItemHistory[1311]\n\n=== INSTRUCTIONS ===\nYou MUST follow these rules:\n- ALWAYS execute 2-3 commands before calling Finish\n- For user analysis: Get UserInfo + UserHistory\n- For item analysis: Get ItemInfo (and optionally ItemHistory)\n- Extract SPECIFIC details (genres, ratings, attributes)\n- Match query IDs to task (if task is 'user 821', query [821]; if 'item 1311', query [1311])\n- DO NOT repeat commands from previous steps\n\n=== YOUR HISTORY ===\n{history}\n\n=== TARGET ===\nAnalyze: {analyse_type} {id}"
    },
    "analyst_prompt": {
        "type": "template", 
        "content": "{analyst_base_prompt}\n\n=== COMMAND FORMAT ===\nGenerate ONE command using: CommandName[id]\nExamples: UserInfo[821], ItemInfo[1311], UserHistory[821], Finish[analysis result]\n\n=== REQUIREMENTS ===\n- If this is your first step, use an information gathering command (UserInfo, ItemInfo, or UserHistory)\n- Do NOT use Finish for the first step\n- Include specific extracted details in Finish (genres, ratings, preferences)\n\nNow generate your command:\n"
    },
    "analyst_prompt_json": {
        "type": "template", 
        "content": "{analyst_base_prompt}\n\n=== JSON COMMAND FORMAT (STRICT) ===\nYou MUST respond with ONLY valid JSON - NO OTHER TEXT:\n{{\"type\":\"CommandName\",\"content\":id_or_text}}\n\n*** JSON STRUCTURE RULES (CRITICAL) ***\n- ALWAYS use double curly braces: {{ and }} (NOT single)\n- \"type\" field MUST be EXACTLY one of: UserInfo, ItemInfo, UserHistory, ItemHistory, Finish\n- \"content\" field for queries MUST be ONLY a NUMBER (e.g., 821, 1311, 258)\n- \"content\" field for Finish MUST be 2-3 sentences of analysis text, NO formatting\n- NO arrays []\n- NO nested objects\n- NO extra text before or after JSON\n\n*** QUERY ID MATCHING (CRITICAL) ***\nWhen analyzing 'user 821': content MUST be 821 (NOT \"821\" or text)\nWhen analyzing 'item 1311': content MUST be 1311 (NOT \"1311\" or text)\nMatch the ID to the task context!\n\n✅ CORRECT EXAMPLES (COPY THIS FORMAT):\n{{\"type\":\"UserInfo\",\"content\":821}}\n{{\"type\":\"ItemInfo\",\"content\":1311}}\n{{\"type\":\"UserHistory\",\"content\":821}}\n{{\"type\":\"ItemHistory\",\"content\":1311}}\n{{\"type\":\"Finish\",\"content\":\"User 821 prefers drama films with 4-5 star ratings. Watched Crime and Thriller. Suitable for recommendation.\"}}\n\n❌ INCORRECT EXAMPLES (NEVER USE THESE):\n[{{\"type\":\"UserInfo\",\"content\":821}}] - WRONG: Array format\n{{\"type\":\"UserInfo\",\"content\":\"821\"}} - WRONG: ID must be number not string\n{{\"type\":\"ItemInfo\",\"content\":\"Long description text...\"}} - WRONG: content should be ID\n{{\"type\":\"Finish\",\"content\":\"done\"}} - WRONG: Too vague\n{{\"type\":\"UserInfo\",\"id\":821}} - WRONG: Field should be 'content'\n\n=== EXECUTION RULES ===\n1. FIRST step: MUST use UserInfo, ItemInfo, or UserHistory - NEVER Finish\n2. SECOND step: Use DIFFERENT command type than step 1\n3. THIRD+ steps: Can call Finish if analysis complete\n4. Each response MUST be valid JSON with correct numeric content field\n\nGenerate your command (JSON only, no other text):\n"
    },
    "analyst_examples": {
        "type": "raw",
        "content": "EXAMPLE EXECUTION SEQUENCE:\nStep 1: UserInfo[821] → Get user profile\nStep 2: UserHistory[821] → Get user's movie watch history\nStep 3: Finish[User 821 is a 37-year-old engineer who prefers Drama and Crime films with ratings 4-5 stars]"
    },
    "analyst_examples_json": {
        "type": "raw",
        "content": "EXAMPLE EXECUTION SEQUENCE (JSON mode):\nStep 1: {{\"type\":\"UserInfo\",\"content\":821}} → Retrieve user demographics and profile\nStep 2: {{\"type\":\"UserHistory\",\"content\":821}} → Get interaction history with ratings\nStep 3: {{\"type\":\"Finish\",\"content\":\"User 821: age 37, engineer; prefers Drama(★★★★★), Crime(★★★★); dislikes Horror films\"}}"
    },
    "analyst_fewshot": {
        "type": "raw",
        "content": "Task: Analyze user 821\nExecution:\n  Query: UserInfo[821] → Found: Age 37, occupation: engineer\n  Query: UserHistory[821] → Found: Pulp Fiction (5★), Silence of Lambs (5★), Enchanted April (5★)\n  Result: User 821 strongly prefers Drama, Crime, Thriller genres (mostly 5-star ratings)\n\nTask: Analyze item 1311\nExecution:\n  Query: ItemInfo[1311] → Found: Waiting to Exhale, Comedy|Drama, 1995\n  Result: Item 1311 is a Drama-Comedy from 1995"
    },
    "analyst_fewshot_json": {
        "type": "raw",
        "content": "=== COMMAND EXECUTION TRACKING ===\nKEEP TRACK of which commands you've executed:\n- Step 1: Execute one query type\n- Step 2: Execute DIFFERENT query type  \n- Step 3+: Different or same, then Finish\nNEVER repeat same command ID!\n\n=== EXAMPLE 1: Analyze User 821 ===\nTask: \"Analyze user 821's profile, interaction history, and extract genre preferences with rating patterns\"\nStep 1: {{\"type\":\"UserInfo\",\"content\":821}}\n  Result: Age 37, male, engineer, preferences extracted\nStep 2: {{\"type\":\"UserHistory\",\"content\":821}}\n  Result: Watched Pulp Fiction(5★), Silence of Lambs(5★), Enchanted April(5★)\nStep 3: {{\"type\":\"Finish\",\"content\":\"User 821: 37yo engineer. Prefers Drama(5★) and Crime(5★) genres. Strong 5-star ratings indicate quality preference. Dislikes Horror.\"}}\n\n=== EXAMPLE 2: Analyze Item 1311 ===\nTask: \"Analyze candidate item 1311: Title: Waiting to Exhale (1995), Genres: Comedy|Drama\"\nStep 1: {{\"type\":\"ItemInfo\",\"content\":1311}}\n  Result: Waiting to Exhale, 1995, Comedy|Drama\nStep 2: {{\"type\":\"ItemHistory\",\"content\":1311}}\n  Result: Watched by 25 users, avg rating 3.8/5\nStep 3: {{\"type\":\"Finish\",\"content\":\"Item 1311: Waiting to Exhale (1995) is Comedy|Drama. Average user rating 3.8★. Appeals to Drama and Comedy fans.\"}}\n\n=== KEY EXECUTION RULES ===\n- Queries MUST match task context (user IDs for user analysis, item IDs for item analysis)\n- NEVER use wrong ID (like user ID for item analysis)\n- ALWAYS use numeric content field for queries: {{\"type\":\"ItemInfo\",\"content\":1311}} (not \"1311\")\n- ALWAYS use text content for Finish: {{\"type\":\"Finish\",\"content\":\"specific analysis text here\"}}"
    },
    "analyst_hint": {
        "type": "raw",
        "content": "Key Tip: Always use 2-3 information gathering commands before Finish. Extract specific genre, rating, and user preference details."
    }
}
